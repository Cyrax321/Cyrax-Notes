<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Cyrax Notes</title>
        <style>
            body {
                  font-family: Arial, sans-serif;
                        margin: 20px;
                              background-color: #f7f7f7;
                                    color: #333;
                                        }
                                            textarea {
                                                  width: 100%;
                                                        height: 300px;
                                                              font-size: 16px;
                                                                    padding: 10px;
                                                                          border: 1px solid #ccc;
                                                                                border-radius: 5px;
                                                                                      resize: none;
                                                                                          }
                                                                                              .controls {
                                                                                                    margin-top: 10px;
                                                                                                        }
                                                                                                            button, input {
                                                                                                                  margin-right: 10px;
                                                                                                                        padding: 10px 20px;
                                                                                                                              font-size: 16px;
                                                                                                                                    border: none;
                                                                                                                                          border-radius: 5px;
                                                                                                                                                cursor: pointer;
                                                                                                                                                    }
                                                                                                                                                        button.save {
                                                                                                                                                              background-color: #4caf50;
                                                                                                                                                                    color: white;
                                                                                                                                                                        }
                                                                                                                                                                            input {
                                                                                                                                                                                  border: 1px solid #ccc;
                                                                                                                                                                                        width: calc(100% - 20px);
                                                                                                                                                                                            }
                                                                                                                                                                                                .link-container {
                                                                                                                                                                                                      margin-top: 15px;
                                                                                                                                                                                                            display: none;
                                                                                                                                                                                                                }
                                                                                                                                                                                                                    .link-container a {
                                                                                                                                                                                                                          color: #008cba;
                                                                                                                                                                                                                                text-decoration: none;
                                                                                                                                                                                                                                      font-weight: bold;
                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                            </style>
                                                                                                                                                                                                                                            </head>
                                                                                                                                                                                                                                            <body>

                                                                                                                                                                                                                                            <h1>Cyrax Notes</h1>
                                                                                                                                                                                                                                            <textarea id="noteArea" placeholder="Start typing your note here..."></textarea>
                                                                                                                                                                                                                                            <div class="controls">
                                                                                                                                                                                                                                              <button class="save" onclick="saveNote()">Generate Link</button>
                                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                                              <div class="link-container" id="linkContainer">
                                                                                                                                                                                                                                                <p>Your sharable link:</p>
                                                                                                                                                                                                                                                  <input type="text" id="noteLink" readonly>
                                                                                                                                                                                                                                                    <p><a href="#" id="viewLink" target="_blank">View Note</a></p>
                                                                                                                                                                                                                                                    </div>

                                                                                                                                                                                                                                                    <script>
                                                                                                                                                                                                                                                      const API_URL = "https://api.jsonbin.io/v3/b";
                                                                                                                                                                                                                                                        const API_KEY = "$2a$10$gx99fczG60mkwcmI7n335ezNigkVVBylK0l7WbDB0618iBbcI/DOS";

                                                                                                                                                                                                                                                          window.onload = async function () {
                                                                                                                                                                                                                                                              const params = new URLSearchParams(window.location.search);
                                                                                                                                                                                                                                                                  const noteId = params.get('id');
                                                                                                                                                                                                                                                                      if (noteId) {
                                                                                                                                                                                                                                                                            loadNoteFromId(noteId);
                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                  };

                                                                                                                                                                                                                                                                                    async function saveNote() {
                                                                                                                                                                                                                                                                                        const noteContent = document.getElementById("noteArea").value.trim();
                                                                                                                                                                                                                                                                                            if (!noteContent) {
                                                                                                                                                                                                                                                                                                  alert("Please enter a note before generating a link.");
                                                                                                                                                                                                                                                                                                        return;
                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                try {
                                                                                                                                                                                                                                                                                                                      const response = await fetch(API_URL, {
                                                                                                                                                                                                                                                                                                                              method: "POST",
                                                                                                                                                                                                                                                                                                                                      headers: {
                                                                                                                                                                                                                                                                                                                                                "Content-Type": "application/json",
                                                                                                                                                                                                                                                                                                                                                          "X-Master-Key": API_KEY
                                                                                                                                                                                                                                                                                                                                                                  },
                                                                                                                                                                                                                                                                                                                                                                          body: JSON.stringify({ note: noteContent })
                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                      if (response.ok) {
                                                                                                                                                                                                                                                                                                                                                                                              const data = await response.json();
                                                                                                                                                                                                                                                                                                                                                                                                      const noteId = data.metadata.id;
                                                                                                                                                                                                                                                                                                                                                                                                              const link = `${window.location.origin}${window.location.pathname}?id=${noteId}`;
                                                                                                                                                                                                                                                                                                                                                                                                                      displayLink(link);
                                                                                                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                    alert("Error saving note.");
                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                              } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                    console.error("Error:", error);
                                                                                                                                                                                                                                                                                                                                                                                                                                                          alert("Error connecting to the server.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                  function displayLink(link) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const linkContainer = document.getElementById("linkContainer");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const noteLink = document.getElementById("noteLink");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const viewLink = document.getElementById("viewLink");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  noteLink.value = link;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      viewLink.href = link;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          linkContainer.style.display = "block";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              async function loadNoteFromId(noteId) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const response = await fetch(`${API_URL}/${noteId}`, {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                headers: { "X-Master-Key": API_KEY }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (response.ok) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const data = await response.json();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            document.getElementById("noteArea").value = data.record.note;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    alert("Note loaded successfully.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  alert("Note not found or access denied.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  console.error("Error:", error);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        alert("Error connecting to the server.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </script>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              